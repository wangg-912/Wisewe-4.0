var e=Object.defineProperty,l=Object.prototype.hasOwnProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,n=(l,t,o)=>t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o,a=(e,a)=>{for(var s in a||(a={}))l.call(a,s)&&n(e,s,a[s]);if(t)for(var s of t(a))o.call(a,s)&&n(e,s,a[s]);return e};import{w as s,a as i,Q as r,u as c,d as u,E as d,l as f,R as p,v as g,S as m,c as h,j as b,k as v,L as C,B as y,U as w,C as k,f as O,m as F,V as S,A as D,M as H,o as x,n as R,W as $,X as j,P,g as T,Y as _,Z as B,r as E,t as M}from"./element-plus.3788f1c9.js";import{p as W,l as I,t as V,b as z,m as A,n as q,o as L,q as N,s as X,v as Y}from"./index.7442e940.js";import{u as J}from"./useAttrs.3d5ffbca.js";import{o as G,i as Q}from"./omit.0b777784.js";import{i as U}from"./isEqual.bd391a24.js";import"./_baseIsEqual.945998d2.js";import"./isObject.356ba3ed.js";import"./_baseGet.b63eb0f5.js";import"./isSymbol.69d4e912.js";const Z=(...e)=>e,K=Z("primary","success","warning","danger","info","text"),ee=Z("plain","circle","round"),le=Z("medium ","small","mini"),te={visible:W.bool,width:W.number.def(640),height:W.number.def(400),draggable:W.bool.def(!0),cancelText:W.string.def("取消"),okText:W.string.def("确定"),okType:W.string.def("primary"),showClose:W.bool.def(!0),modal:W.bool.def(!0),size:W.oneOf(le).def("mini"),type:W.oneOf(K).def("info"),shape:W.oneOf(ee).def("plain"),disabled:W.bool.def(!1),icon:W.string,autofocus:W.bool.def(!1),"native-type":W.oneOf(["button","submit","reset"]).def("button")},oe=Object.assign({},te,{title:W.string.def("标题"),titleIcon:W.bool,fullscreen:W.bool.def("false"),canFullscreen:W.bool.def(!0),wrapperFooterOffset:W.number.def(0),useWrapper:W.bool.def(!0),loading:W.bool,showCancelBtn:W.bool.def(!0),showOkBtn:W.bool.def(!0),wrapperProps:Object,bodyStyle:Object,closeIcon:Object,destroyOnClose:W.bool.def(!0),footer:Object,open:Function,close:Function,save:Function,beforeClose:Function,closeOnClickModal:W.bool.def(!1),visible:W.bool,customClass:W.string,renderFrame:W.bool.def(!1),indata:{type:Object,default:null},closeOnPressEscape:W.bool.def(!1)});function ne(e,l,t=!1){if(!I(e))throw new Error("handle is not Function!");const{readyRef:o,stop:n,start:a}=function(e){const l=i(!1);let t;function o(){l.value=!1,t&&window.clearTimeout(t)}function n(){o(),t=setTimeout((()=>{l.value=!0}),e)}return n(),V(o),{readyRef:l,stop:o,start:n}}(l);return t?e():s(o,(l=>{l&&e()}),{immediate:!1}),{readyRef:o,stop:n,start:a}}function ae(e){const l=(e,l)=>getComputedStyle(e)[l],t=t=>{if(!t)return;t.setAttribute("data-drag",c(e.draggable));const o=t.querySelector(".el-dialog__header"),n=t.querySelector(".el-dialog");o&&n&&c(e.draggable)&&(o.style.cursor="move",o.onmousedown=e=>{if(!e)return;const t=e.clientX,o=e.clientY,a=document.body.clientWidth,s=document.documentElement.clientHeight,i=n.offsetWidth,r=n.offsetHeight,c=n.offsetLeft,u=a-n.offsetLeft-i,d=n.offsetTop,f=s-n.offsetTop-r,p=l(n,"left"),g=l(n,"top");let m=+p,h=+g;p.includes("%")?(m=+document.body.clientWidth*(+p.replace(/%/g,"")/100),h=+document.body.clientHeight*(+g.replace(/%/g,"")/100)):(m=+p.replace(/px/g,""),h=+g.replace(/px/g,"")),document.onmousemove=function(e){let l=e.clientX-t,a=e.clientY-o;-l>c?l=-c:l>u&&(l=u),-a>d?a=-d:a>f&&(a=f),n.style.cssText+=`;left:${l+m}px;top:${a+h}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})};r((()=>{c(e.visible)&&c(e.draggable)&&ne((()=>{(()=>{const o=document.querySelectorAll(".el-overlay");for(const n of Array.from(o)){if(!n)continue;const o=l(n,"display"),a=n.getAttribute("data-drag");"none"!==o&&(null===a||c(e.destroyOnClose))&&t(n)}})()}),30)}))}function se(e,l=[]){const t=Object.keys(e),o={};return t.map((t=>{if(l.includes(t))return null;o[t]=()=>function(e,l="default",t){if(!e||!Reflect.has(e,l))return null;if(!I(e[l]))return null;const o=e[l];return o?o(t):null}(e,t)})),o}var ie=u({name:"Dialog",inheritAttrs:!1,props:oe,setup(e,{slots:l}){const{visible:t,draggable:o,destroyOnClose:n}=d(e),s=J();return ae({visible:t,destroyOnClose:n,draggable:o}),()=>{let t;const o=a(a({},c(s)),e);return f(m,g({"model-value":o.visible},o,{showClose:!1}),"function"==typeof(n=t=se(l))||"[object Object]"===Object.prototype.toString.call(n)&&!p(n)?t:{default:()=>[t]});var n}}}),re=u({name:"DialogToolbar",props:{showClose:W.bool.def(!0),canFullscreen:W.bool.def(!0),fullscreen:W.bool},emits:["close","fullscreen"],setup(e,{emit:l}){const{prefixCls:t}=z("basic-modal-toolbar");return{getToolCls:h((()=>[t,`${t}--custom`,{[`${t}--can-full`]:e.canFullscreen}])),prefixCls:t,handleCancel:function(){l("close")},handleFullScreen:function(e){null==e||e.stopPropagation(),null==e||e.preventDefault(),l("fullscreen")}}}});re.render=function(e,l,t,o,n,a){return b(),v("div",{class:e.getToolCls},[e.canFullscreen?(b(),v(C,{key:0},[e.fullscreen?(b(),v("i",{key:1,class:["el-icon-crop",`${e.prefixCls}__icon`],role:"close",onClick:l[2]||(l[2]=(...l)=>e.handleFullScreen&&e.handleFullScreen(...l))},null,2)):(b(),v("i",{key:0,class:["el-icon-full-screen",`${e.prefixCls}__icon`],role:"full",onClick:l[1]||(l[1]=(...l)=>e.handleFullScreen&&e.handleFullScreen(...l))},null,2))],64)):y("",!0),e.showClose?(b(),v("i",{key:1,class:["el-icon-close",`${e.prefixCls}__icon`],onClick:l[3]||(l[3]=(...l)=>e.handleCancel&&e.handleCancel(...l))},null,2)):y("",!0)],2)};var ce=u({name:"BasicTitle",props:{span:W.bool},setup(){const{prefixCls:e}=z("basic-title");return{prefixCls:e}}});const ue=k()(((e,l,t,o,n,a)=>(b(),v("span",{class:[e.prefixCls,{"show-span":e.span&&e.$slots.default}]},[w(e.$slots,"default",{},void 0,!0)],2))));ce.render=ue,ce.__scopeId="data-v-5cc8b29b";var de=u({name:"DialogHeader",components:{BasicTitle:ce},props:{title:W.string,icon:W.string}});de.render=function(e,l,t,o,n,a){const s=O("BasicTitle");return b(),v(s,null,{default:F((()=>[e.icon?(b(),v("i",{key:0,class:e.icon,size:"18",style:{display:"flex","justify-content":"center","align-items":"center","padding-right":"4px"}},null,2)):y("",!0),S(" "+D(e.title),1)])),_:1})};const fe=Symbol();var pe=u({name:"DialogWrapper",inheritAttrs:!1,props:{loading:W.bool,useWrapper:W.bool.def(!0),modalHeaderHeight:W.number.def(45),modalFooterHeight:W.number.def(55),width:W.number.def(640),height:W.number,footerOffset:W.number.def(0),visible:W.bool,fullscreen:W.bool,renderFrame:W.bool.def(!1)},emits:["height-change","ext-height"],setup(e,{emit:l}){const{prefixCls:t}=z("dialog-wrapper"),o=i(null),n=i(null),a=i(0),u=i(0);i(null);let d=0;q(p.bind(null,!1)),A({redoModalHeight:p},fe);const f=h((()=>({width:`${e.width}px`,height:`${c(a)}px`,padding:"8px"})));async function p(){if(!e.visible)return;const t=c(o);if(!t)return;const s=t.$el.parentElement;if(s){s.style.padding="0",await R();try{const t=s.parentElement&&s.parentElement.parentElement;if(!t)return;const o=getComputedStyle(t).top,i=Number.parseInt(o);let r=window.innerHeight-2*i+(e.footerOffset||0)-e.modalFooterHeight-e.modalHeaderHeight;await R();const u=c(n);if(!u)return;await R(),d=u.scrollHeight,e.fullscreen?a.value=window.innerHeight-e.modalFooterHeight-e.modalHeaderHeight:a.value=e.height?e.height:d>r?r:d,l("height-change",c(a))}catch(i){}}}return r((()=>{e.useWrapper&&p()})),s((()=>e.fullscreen),(e=>{p(),e?u.value=a.value:a.value=u.value})),H((()=>{const{modalHeaderHeight:t,modalFooterHeight:o}=e;l("ext-height",t+o)})),x((()=>{})),{prefixCls:t,wrapperRef:o,spinRef:n,spinStyle:f,setModalHeight:p}}});pe.render=function(e,l,t,o,n,a){const s=O("el-scrollbar"),i=$("loading");return b(),v(s,{ref:"wrapperRef",class:e.prefixCls},{default:F((()=>[j(f("div",{ref:"spinRef",style:e.spinStyle,"element-loading-text":e.loadingTip},[w(e.$slots,"default")],12,["element-loading-text"]),[[i,e.loading]])])),_:3},8,["class"])};var ge=u({name:"DialogFooter",props:oe,emits:["save","close"],setup:(e,{emit:l})=>({handleOk:function(){l("save")},handleCancel:function(){l("close")}})});ge.render=function(e,l,t,o,n,a){const s=O("el-button");return b(),v("div",null,[w(e.$slots,"insertFooter"),e.showCancelBtn?(b(),v(s,{key:0,type:"info",onClick:e.handleCancel,size:e.size},{default:F((()=>[S(D(e.cancelText),1)])),_:1},8,["onClick","size"])):y("",!0),w(e.$slots,"centerFooter"),e.showOkBtn?(b(),v(s,{key:1,type:e.okType,onClick:e.handleOk,size:e.size},{default:F((()=>[S(D(e.okText),1)])),_:1},8,["type","onClick","size"])):y("",!0),w(e.$slots,"appendFooter")])};var me=u({name:"BasicDialog",components:{Dialog:ie,DialogToolbar:re,DialogHeader:de,DialogWrapper:pe,DialogFooter:ge},inheritAttrs:!1,props:oe,emits:["visible-change","height-change","cancel","save","register"],setup(e,{emit:l,attrs:t}){const o=i(null),n=i(!1),u=i(null),d=i(null),f=i(null),p=i(0),g={setModalProps:function(e){if(u.value=L(c(u)||{},e),!Reflect.has(e,"visible"))return;n.value=!!e.visible},emitVisible:void 0,redoModalHeight:()=>{R((()=>{c(d)&&c(d).setModalHeight()}))},callbackFn:e=>O(e)},m=T();m&&l("register",g,m.uid);const b=h((()=>a(a(a({},e),c(u)),{dialogId:`${m.uid}`,iframeId:`iframe_${m.uid}`}))),{handleFullScreen:v,getCustomClass:C,fullScreenRef:y}=function(e){const l=i(!1);return{getCustomClass:h((()=>{const t=c(e.customClass)||"";return c(l)?`is-fullscreen ${t} `:c(t)})),handleFullScreen:function(e){e&&e.stopPropagation(),l.value=!c(l)},fullScreenRef:l}}({modalWrapperRef:d,extHeightRef:p,customClass:P(b.value,"customClass")}),w=h((()=>{const e=a(a({},c(b)),{visible:c(n),title:void 0});return a(a({},e),{customClass:c(C.value)})})),k=h((()=>{const{url:e,dialogId:l}=c(w);return e&&(/^(http|https|www)/g.test(e)||e.includes(".html"))?a(a(a({},t),c(w)),{url:e.includes("?")?`${e}&dialogId=${l}`:`${e}?dialogId=${l}`,renderFrame:!0}):a(a({},t),c(w))}));function O(e){const{type:t,data:o}=e;if(t&&!Q(o)){const{callback:e}=k.value;e&&I(e)&&(e.call(this,o),n.value=!1,l("close")),l("callback")}}return r((()=>{n.value=!!e.visible,y.value=!!e.fullscreen})),s((()=>c(n)),(e=>{var t;l("visible-change",e),m&&(null==(t=g.emitVisible)||t.call(g,e,m.uid)),R((()=>{}))}),{immediate:!1}),{frameRef:f,dialogRef:o,visibleRef:n,modalWrapperRef:d,getProps:w,fullScreenRef:y,getMergeProps:b,getBindValue:k,handleFullScreen:v,omit:G,handleOk:function(){const e=c(f);if(e){const t=e.contentWindow.dialogOk();l("save",t)}else l("save")},handleCancel:async function(t){if(null==t||t.stopPropagation(),e.close&&I(e.close)){const l=await e.close();n.value=!l}else n.value=!1,l("cancel")},handleCallBack:O,handleExtHeight:function(e){p.value=e},handleHeightChange:function(e){l("height-change",e)},handleTitleDbClick:function(l){e.canFullscreen&&(l.stopPropagation(),v(l))}}}});const he={class:"dialog-slot-title"};me.render=function(e,l,t,o,n,a){const s=O("DialogHeader"),i=O("DialogToolbar"),r=O("DialogFooter"),c=O("DialogWrapper"),u=O("Dialog");return b(),v(u,g({ref:"dialogRef",onOpen:e.handleOpen,onClose:e.handleCancel},e.getBindValue,{fullscreen:e.fullScreenRef}),_({default:F((()=>[f(c,g({useWrapper:e.getProps.useWrapper,footerOffset:e.wrapperFooterOffset,ref:"modalWrapperRef",loading:e.getProps.loading,width:e.getProps.width,height:e.getProps.height,visible:e.visibleRef,fullscreen:e.fullScreenRef,renderFrame:e.getProps.renderFrame,indata:e.getProps.indata,url:e.getProps.url,modalFooterHeight:void 0===e.footer||e.footer?void 0:0},e.omit(e.getProps.wrapperProps,"visible","height"),{onExtHeight:e.handleExtHeight,onHeightChange:e.handleHeightChange}),{default:F((()=>[e.getBindValue.renderFrame&&e.getBindValue.url?(b(),v("iframe",{key:0,ref:"frameRef",id:e.getBindValue.iframeId,src:e.getBindValue.url,frameborder:"0",style:{width:"100%","min-height":"100%",overflow:"auto"}},null,8,["id","src"])):w(e.$slots,"default",{key:1})])),_:3},16,["useWrapper","footerOffset","loading","width","height","visible","fullscreen","renderFrame","indata","url","modalFooterHeight","onExtHeight","onHeightChange"])])),_:2},[e.$slots.title?void 0:{name:"title",fn:F((()=>[f("div",he,[f(s,{title:e.getMergeProps.title,icon:e.getMergeProps.titleIcon,onDblclick:e.handleTitleDbClick},null,8,["title","icon","onDblclick"]),f(i,{showClose:e.getBindValue.showClose,fullscreen:e.fullScreenRef,onClose:e.handleCancel,onFullscreen:e.handleFullScreen},null,8,["showClose","fullscreen","onClose","onFullscreen"])])]))},e.$slots.footer?void 0:{name:"footer",fn:F((()=>[f(r,g(e.getProps,{onSave:e.handleOk,onClose:e.handleCancel}),_({_:2},[B(Object.keys(e.$slots),(l=>({name:l,fn:F((t=>[w(e.$slots,l,t)]))})))]),1040,["onSave","onClose"])]))},B(Object.keys(e.omit(e.$slots,"default")),(l=>({name:l,fn:F((t=>[w(e.$slots,l,t)]))})))]),1040,["onOpen","onClose","fullscreen"])};const be=E({}),ve=E({});function Ce(){N();const e=i(null),l=i(!1),t=i("");window.addEventListener("message",(e=>{var l;const{gid:n,callbackData:a}=e.data;if(t.value==n){const{indata:n}=be[c(t)];if(n){const l=JSON.stringify(n);e.source.postMessage(Object.assign({},JSON.parse(l)))}a&&(null==(l=o())||l.callbackFn({type:"ok",data:a}))}}),!1);const o=()=>{const l=c(e);return l||Y("useDialog instance is undefined!"),l};return[function(o,n){t.value=n,x((()=>{e.value=null,l.value=!1,be[c(t)]=null})),c(l)&&X()&&o===c(e)||(e.value=o,o.emitVisible=(e,l)=>{ve[l]=e})},{callbackFn:(e="ok",l)=>{var t,n;return null==(n=null==(t=o())?void 0:t.callbackFn)?void 0:n.call(t,{type:"ok",data:l})},setModalProps:e=>{var l;null==(l=o())||l.setModalProps(e)},getVisible:h((()=>ve[~~c(t)])),redoModalHeight:()=>{var e,l;null==(l=null==(e=o())?void 0:e.redoModalHeight)||l.call(e)},openDialog:(e,l=!0,n=!0)=>{var a;const s=Object.assign({loading:!0},e,{visible:l,renderFrame:!!(null==e?void 0:e.url)});if(null==(a=o())||a.setModalProps(s),s.loading&&setTimeout((()=>{var e;null==(e=o())||e.setModalProps({loading:!1}),clearTimeout(undefined)}),650),n)return be[c(t)]=null,void(be[c(t)]=e);U(M(be[c(t)]),e)||(be[c(t)]=e)}}]}var ye=u({components:{BasicDialog:me},setup(){const[e,{openDialog:l}]=Ce(),[t,{openDialog:o}]=Ce(),[n,{openDialog:a}]=Ce();return{register1:e,register2:t,register3:n,openDailog1:l,openDailog2:o,openDialogOne:function(){l({title:"新增",titleIcon:"el-icon-document-add",width:720,height:500,url:`/src/html/test.html?t=${+new Date}&id=123`,indata:{data:{type:"add",id:"100121210",infos:{name:"测试一下"}}},callback:function(e){}})},openDialogTwo:function(){o({loading:!1,title:"修改",showClose:!1,indata:{name:"zs",age:"28"}})},openDialogThree:function(){a()},testCancel:function(){},testSave:function(e){},testCpSave:function(){},testHandler:function(){}}}});const we=S("测试IFrame模态窗"),ke=S("测试Component模态窗"),Oe=S("测试无参数模态窗"),Fe=S("Components组件"),Se=S("无参数模态窗"),De={class:"grid-content",ref:"gridContent"};ye.render=function(e,l,t,o,n,a){const s=O("el-button"),i=O("BasicDialog"),r=O("DialogExtend"),c=O("el-col"),u=O("el-row");return b(),v(C,null,[f(s,{type:"primary",onClick:e.openDialogOne},{default:F((()=>[we])),_:1},8,["onClick"]),f(s,{type:"primary",onClick:e.openDialogTwo},{default:F((()=>[ke])),_:1},8,["onClick"]),f(s,{type:"primary",onClick:e.openDialogThree},{default:F((()=>[Oe])),_:1},8,["onClick"]),f(i,{onRegister:e.register1,onCancel:e.testCancel,onSave:e.testSave},null,8,["onRegister","onCancel","onSave"]),f(i,{onRegister:e.register2,onCancel:e.testCancel,onSave:e.testCpSave},{default:F((()=>[Fe])),_:1},8,["onRegister","onCancel","onSave"]),f(i,{onRegister:e.register3,onCancel:e.testCancel},{default:F((()=>[Se])),_:1},8,["onRegister","onCancel"]),f(u,null,{default:F((()=>[f(c,{span:24},{default:F((()=>[f("div",De,[f(r)],512)])),_:1})])),_:1})],64)};export default ye;
